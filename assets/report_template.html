<!doctype html>
<html>
    <head>
        <title></title>
        <meta charset="utf-8" />
        {% for css_style in css %}
        <style>
            {{ css_style | trim | indent(width=12) }}
        </style>
        {% endfor %}
    </head>
    <body>
        <header class="mx-4 my-6">
            <h1 class="text-6xl">WGS benchmark report</h1>
            <small class="text-lg">Report generated at <time>{{ now.strftime("%Y-%m-%d %H:%M:%S") }}</time></small>
        </header>
        <main class="mx-4 my-6">
            <section class="my-16">
                <h2 class="text-4xl my-8">Comparisons</h2>
                <div class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-4 m-4">
                {% for comp_id, comp in comparisons.items() %}
                    <div class="comparison-info flex justify-around gap-4 items-center bg-gray-100 hover:bg-blue-200 px-6 py-3" data-id="{{ comp.id }}" >
                        <div class="text-4xl text-center"><p>{{ comp.id }}</p></div>
                        <table display="block">
                            <tr>
                                <th class="text-right pr-2">Truth set</th>
                                <td>{{ comp.truthset_name }}</td>
                            </tr>
                            <tr>
                                <th class="text-right pr-2">Query set</th>
                                <td>{{ comp.queryset_name }}</td>
                            </tr>
                            <tr>
                                <th class="text-right pr-2">Genome used for comparison</th>
                                <td>{{ comp.genome }}</td>
                            </tr>
                            <tr>
                                <th class="text-right pr-2">Truth set original genome</th>
                                <td>{{ comp.original_truth_genome }}</td>
                            </tr>
                        </table>
                    </div>
                {% endfor %}
                </div>
            </section>

            <section class="my-16">
                <h2 class="text-4xl my-8">hap.py summary</h2>
                {#<select>
                    {% for name in comparisons[0].happy_summary.column_names %}
                    <option>{{ name }}</option>
                    {% endfor %}
                </select>#}
                <div class="overflow-auto">
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                {% set comp = comparisons.values() | first %}
                                {% for name in comp.happy_summary.column_names %}
                                <th>{{ name }}</th>
                                {% endfor %}
                            </tr>
                        </thead>
                        <tbody>
                            {% for comp in comparisons.values() %}
                            {% for row in comp.happy_summary.rows %}
                            <tr data-id="{{ comp.id }}" class="hover:bg-blue-200">
                                <td>{{ comp.id }}</td>
                                {% for key in comp.happy_summary.column_names %}
                                    {% if row[key] is float %}
                                    <td class="text-right">{{ "{0:,.2f}".format(row[key]) }}</td>
                                    {% elif row[key] is integer %}
                                    <td class="text-right">{{ "{0:,d}".format(row[key]) }}</td>
                                    {% else %}
                                    <td>{{ row[key] }}</td>
                                    {% endif %}
                                {% endfor %}
                            </tr>
                            {% endfor %}
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </section>

            <section class="my-16">
                <h2 class="text-4xl my-8">Coverage</h2>
                {% for comp in comparisons.values() %}
                <div>
                    <h3 class="text-2xl my-6">{{ comp.id }} &ndash; {{ comp.queryset_name }}</h3>
                    {% if comp.id not in coverage %}
                    <p>No coverage data avaliable.</p>
                    {% else %}
                    <div id="global-coverage-{{ comp.id }}">
                        <h4 class="text-xl my-4">Global coverage</h4>
                        <p class="plot-description">There is data here!</p>
                    </div>
                    <div id="regional-coverage-{{ comp.id }}">
                        <h4 class="text-xl my-4">Regional coverage</h4>
                        {% if coverage[comp.id].coverage.regional_coverage | length > 0 %}
                        <select data-id="{{ comp.id }}" class="coverage-region-selector">
                            {% for region in coverage[comp.id].coverage.regional_coverage %}
                            <option value="{{ loop.index0 }}">{{ region.name }}</option>
                            {% endfor %}
                        </select>
                        <div data-id="{{ comp.id }}" class="regional-coverage">
                        </div>
                        {% else %}
                        <p>No regional coverage available</p>
                        {% endif %}
                    </div>
                    {% endif %}
                </div>
                {% endfor %}
            </section>
        </main>
        <script>
            const jsonData = {{ comparisons.values() | list | tojson }};
            const coverageData = {{ coverage.values() | list | tojson }};
        </script>
        {% for script in js %}
        <script>
            {{ script | trim | indent(width=12) }}
        </script>
        {% endfor %}
    </body>
</html>
